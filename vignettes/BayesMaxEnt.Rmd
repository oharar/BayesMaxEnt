---
title: "Simple Use of BayesMaxEnt"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simple Use of BayesMaxEnt}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(BayesMaxEnt)
#library(maxnet) # this shouldn't be needed, but the vignette doesn't work otherwise
library(bayesplot)
```


Set up the data

``` {r run_examples}
library(disdat)
CAN <- disData("CAN")
EnvPO <- c("alt", "asp2", "ontprec", "ontprec4", "ontprecsd", "ontslp", 
           "onttemp", "onttempsd", "onttmin4", "ontveg", "watdist")
Species <- "can02"

SpData <- rbind(CAN$po[CAN$po$spid==Species,c("occ", EnvPO)], CAN$bg[,c("occ", EnvPO)])
SpData[,EnvPO] <- apply(SpData[,EnvPO], 2, scale) # scale covariates
```

Because Nimble wants the data in its own format, we have a function to do the conversion. here we just use linear features, rather than everything.

Unfotunately this is currently giving an error (it works when copying and pasting the code, but not when rendering the vignette).

```{r RunModel, message=FALSE, results='hide', eval=TRUE, error=TRUE}
ToNimble <- SetUpMaxEnt(p=SpData$occ, data=SpData[,EnvPO], 
                        regmult = 1, lambda=0.1, classes="l")
output <- FitMaxEnt(maxdat=ToNimble, parallel = TRUE, adaptInterval=50,
                    nchains=2, nburnin = 50, niter=150, thin=1)
```

With 100 iterations we cannot see much, and at the moment this code is parked until the error above is sorted out.

```{r PlotOutput, eval=FALSE}
mcmc_trace(output, pars = c("alpha", "beta[1]"))
```


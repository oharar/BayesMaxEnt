---
title: "Simple Use of BayesMaxEnt"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simple Use of BayesMaxEnt}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(BayesMaxEnt)
#library(maxnet) # this shouldn't be needed, but the vignette doesn't work otherwise
library(bayesplot)
```


Set up the data

``` {r run_examples}
library(disdat)
CAN <- disData("CAN")
EnvPO <- c("alt", "asp2", "ontprec", "ontprec4", "ontprecsd", "ontslp", 
           "onttemp", "onttempsd", "onttmin4", "ontveg", "watdist")
Species <- "can02"

SpData <- rbind(CAN$po[CAN$po$spid==Species,c("occ", EnvPO)], CAN$bg[,c("occ", EnvPO)])
SpData[,EnvPO] <- apply(SpData[,EnvPO], 2, scale) # scale covariates
```

Because Nimble wants the data in its own format, we have a function to do the conversion. here we just use linear features, rather than everything.

NOTE: this chunck of code is not run, because of the following error:

      Error: processing vignette 'BayesMaxEnt.Rmd' failed with diagnostics:
      In sizeAssignAfterRecursing: 'rbern_vec' is not available or its output type is unknown. This may occur if a user-defined function name is the same as the name of a function in a package that `nimble` uses.
       This occurred for: eigenBlock(model_y,1:11477) <<- rbern_vec(=1,p=model_Prob[1:11477],wt=model_W[1:11477])
       This was part of the call:  {
        eigenBlock(model_y,1:11477) <<- rbern_vec(=1,p=model_Prob[1:11477],wt=model_W[1:11477])
      }

It does work (at least for me) when copying and pasting the code. 

```{r RunModel, message=FALSE, results='hide', eval=FALSE}
ToNimble <- SetUpMaxEnt(p=SpData$occ, data=SpData[,EnvPO], 
                        regmult = 1, lambda=0.1, classes="l")
output <- FitMaxEnt(maxdat=ToNimble, parallel = TRUE, adaptInterval=50,
                    nchains=2, nburnin = 50, niter=150, thin=1)
```

With 100 iterations we can see much, but...

```{r PlotOutput, eval=FALSE}
mcmc_trace(output, pars = c("alpha", "beta[1]"))
```

... at least it works. Although the vignette won't render correctly, so this is a placeholder until I can persuade it that it to work.
